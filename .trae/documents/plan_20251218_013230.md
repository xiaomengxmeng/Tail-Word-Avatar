1. **问题分析**

   * 当前代码在发送消息时，总是会在消息末尾添加小尾巴，无论消息内容是否已经包含该小尾巴

   * 需要修改代码，使其在添加小尾巴之前，检查原始消息内容是否已经包含当前的小尾巴文本

   * 如果已经包含，则不再添加小尾巴；否则，正常添加小尾巴

2. **修改方案**

   * 在 `ChatRoom.send` 函数的内容处理部分（第1145-1157行）添加检查逻辑

   * 具体修改步骤：

     1. 获取当前的小尾巴文本 `currentSuffix = getCurrentSuffixText()`
     2. 检查原始消息内容 `originalContent` 是否包含 `currentSuffix`
     3. 如果已经包含，则直接返回原始消息内容，不再添加小尾巴
     4. 否则，按照原逻辑添加小尾巴

3. **修改后的代码结构**

   ```javascript
   content: function () {
       // 获取原始消息内容
       let originalContent = t;
       let currentSuffix = getCurrentSuffixText();

       // 处理小尾巴和单词
       if (t.trim().length == 0 || (!suffixFlag) || needwb == 0 || t.trim().startsWith('凌 ') || t.trim().startsWith('鸽 ') || t.trim().startsWith('小冰 ') || t.trim().startsWith('冰冰 ') || t.trim().startsWith('点歌 ') || t.trim().startsWith('TTS ') || t.trim().startsWith('朗读 ')) {
           return originalContent;
       } else if (originalContent.includes(currentSuffix)) {
           // 如果文本内容已经包含当前小尾巴，不再添加
           return originalContent;
       } else if (wordCount === 0) {
           return originalContent + '\n\n\n>  ' + currentSuffix;
       } else {
           return originalContent + wordMsg + wbMsg;
       }
   }(),
   ```

4. **预期效果**

   * 当用户发送的消息内容已经包含当前设置的小尾巴时，系统不会重复添加小尾巴

   * 当用户发送的消息内容不包含当前设置的小尾巴时，系统会正常添加小尾巴

   * 这将避免小尾巴的重复添加，提高用户体验

5. **代码验证**

   * 修改后的代码将通过语法检查，确保可以正常运行

   * 修改后的代码遵循了原有的代码风格和逻辑

   * 修改后的代码不会影响其他功能的正常运行

